{% extends 'base.html.twig' %}

{% block title %}{{ topic.title }}{% endblock %}

{% block body %}
<div class="forum-container">
    <h1 class="topic-title">{{ topic.title }}</h1>
    
    {% for post in topic.posts %}
    <div class="post {% if loop.first %}first-post{% endif %}">
        <div class="post-sidebar">
            <div class="user-info">
                <strong>{{ post.user.username }}</strong><br>
                <!-- Ajouter d'autres infos utilisateur si disponibles (rang, avatar, etc.) -->
            </div>
        </div>
        <div class="post-content">
            <div class="post-header">
                Posté le {{ post.createdAt|date('d/m/Y H:i') }}
            </div>
            <div class="post-body">
                {{ post.content|nl2br }}
            </div>
            <div class="post-footer">
                {% if app.user == post.user or is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('app_post_edit', {'id': post.id}) }}" class="btn btn-sm btn-secondary">Éditer</a>
                    <form action="{{ path('app_post_delete', {'id': post.id}) }}" method="post" style="display: inline;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ post.id) }}">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce message ?')">Supprimer</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    
    {% if app.user %}
    <div class="reply-form">
        <h3>Répondre</h3>
        {{ form_start(form) }}
            {{ form_widget(form) }}
            <button type="submit" class="btn btn-primary">Envoyer</button>
        {{ form_end(form) }}
    </div>
    {% else %}
        <p>Vous devez être connecté pour répondre.</p>
    {% endif %}
</div>
{% endblock %}